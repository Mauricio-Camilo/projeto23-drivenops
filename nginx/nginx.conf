# Configuração da ferramenta para criar o servidor que faz o SPA funcionar

server {
    listen 80;
# Qualquer requisição que for feita, quando passar pelo /, vai cair nessas regras    
    location / {
    # pasta raíz onde meus arquivos vão servir (padrão de mercado)
    # O build produzido pelo front-end vai ser colocado dentro dessa pasta para ser servida
      root /var/www/html;
    # se a aplicação pedir o /index, o servidor vai devolver o arquivo index.html
      index index.html;

    #caso a aplicação tenha várias rotas, do jeito que está configurado, ele não vai achar,
    # pois o React é uma SPA. Pra qualquer rota, ele deve retornar o index.html
    try_files $uri $uri/ /index.html;
    # Ele vai procurar um arquivo ou uma pasta com esse nome, se não der, retorna o index.html
    }

    #Proxy reverso: A porta 5000 na AWS está bloqueada, então o nginx não alcança o backend.
    # Ao trocar o endereço da requisição no .env do front para a url da AWS com /api, ele vai cair nessa configuração
    # Essa configuração vai fazer a busca ir direto no container do node, ao inveś do localhost
    location /api/ {
      proxy_pass http://node_sorteador_app:5000/;
    }
 }